(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-afea495e"],{3846:function(e,t,a){a("9e1e")&&"g"!=/./g.flags&&a("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:a("0bfb")})},"6b54":function(e,t,a){"use strict";a("3846");var l=a("cb7c"),i=a("0bfb"),o=a("9e1e"),n="toString",r=/./[n],s=function(e){a("2aba")(RegExp.prototype,n,e,!0)};a("79e5")((function(){return"/a/b"!=r.call({source:"a",flags:"b"})}))?s((function(){var e=l(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):r.name!=n&&s((function(){return r.call(this)}))},edd3:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row w-100 ml-1 my-2"},[t("div",{staticClass:"d-flex flex-row mr-4"},[t("DateTimeRangePicker",{model:{value:e.dateTimeRange,callback:function(t){e.dateTimeRange=t},expression:"dateTimeRange"}})],1),t("div",{staticClass:"d-flex flex-row"},[t("DbSelectFilter",{staticClass:"mr-4 mt-1",attrs:{endpoint:"channel/channels/groupby/",field:"cno",descent:!1,label:"通道号",defaultIndex:-1,nullItemText:"所有通道"},model:{value:e.channelNo,callback:function(t){e.channelNo=t},expression:"channelNo"}}),t("DbSelectFilter",{staticClass:"mr-4 mt-1",attrs:{endpoint:"algorithm/algorithms/groupby/",field:"name_ch",descent:!1,label:"算法",defaultIndex:-1,nullItemText:"所有算法"},model:{value:e.algorithm,callback:function(t){e.algorithm=t},expression:"algorithm"}}),t("div",{staticClass:"mr-4 mt-1"},[t("SimpleSelect",{attrs:{itemList:["全部","是","否"],label:"误报"},model:{value:e.isMisReported,callback:function(t){e.isMisReported=t},expression:"isMisReported"}})],1)],1)]),t("div",{staticClass:"row w-100"},[t("ApiDataTable",{attrs:{handlers:e.tableHandlers,tableId:"alertListTableId",dataHeight:660,showWaitingDlg:!1,showSearch:!1,detailView:!1}})],1),t("AlertDeleteDlg",{attrs:{modalId:e.alertDeleteDlgId,alertId:e.currAlertId},on:{"alert-deleted":e.onAlertDeleted}}),t("AlertDetailDlg",{attrs:{modalId:e.alertDetailDlgId,alertId:e.currAlertId},on:{"alert-status-changed":e.onAlertStatusChanged}})],1)},i=[],o=(a("8e6e"),a("456d"),a("ac6a"),a("bd86")),n=(a("7f7f"),a("f217")),r=a("fa7d"),s=a("1157"),c=a.n(s),d=a("0be2"),u=function(){var e=this,t=e._self._c;return t("SimpleModalDlg",{attrs:{modalId:e.modalId,title:"删除报警记录",content:"是否确认删除报警（ID=".concat(e.alertId,"）？"),defaultButtonText:"取消",button2Text:"确认",button2Action:e.button2Action,dialogWidth:300}})},h=[],f=(a("c5f6"),a("f953")),m={name:"AlertDeleteDlg",components:{SimpleModalDlg:f["a"]},data:function(){return{}},props:{modalId:{type:String,required:!0},alertId:{type:Number,required:!0}},computed:{},methods:{button2Action:function(){var e=this,t="alert/alerts/".concat(this.alertId,"/"),a={};d["a"].apiAjaxDelete(t,a,(function(){alert("报警记录删除成功成功！"),e.$emit("alert-deleted")}),r["a"].defaultApiErrorHandler(t,""))}},watch:{},mounted:function(){}},g=m,p=a("2877"),b=Object(p["a"])(g,u,h,!1,null,null,null),v=b.exports,w=function(){var e=this,t=e._self._c;return t("SimpleModalDlg",{attrs:{modalId:e.modalId,dialogWidth:1e3,title:e.alertRec?"通道 ".concat(e.alertRec.channel.cno," - 报警类型：").concat(e.alertRec.algorithm.name_ch):"报警详情",defaultButtonText:""},scopedSlots:e._u([{key:"bodyPost",fn:function(){return[t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[e._v("\n              发生时间："+e._s(e.alertRec?e.formatDateTime(e.alertRec.date_time):"")+"\n            ")])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[e._v("\n              报警位置："+e._s(e.alertRec?e.alertRec.channel.site:"")+"\n            ")])])]),t("div",{staticClass:"col text-right"},[t("label",{staticClass:"mr-2 mt-2 field-label",attrs:{for:e.misReportId}},[e._v("这是误报")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.isMisreported,expression:"isMisreported"}],attrs:{type:"checkbox",id:e.misReportId},domProps:{checked:Array.isArray(e.isMisreported)?e._i(e.isMisreported,null)>-1:e.isMisreported},on:{change:function(t){var a=e.isMisreported,l=t.target,i=!!l.checked;if(Array.isArray(a)){var o=null,n=e._i(a,o);l.checked?n<0&&(e.isMisreported=a.concat([o])):n>-1&&(e.isMisreported=a.slice(0,n).concat(a.slice(n+1)))}else e.isMisreported=i}}})])]),t("div",{staticClass:"row mt-2"},[t("div",{staticClass:"col-6 text-center"},[t("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.rtImgUrl,alt:""}})]),t("div",{staticClass:"col-6 text-center"},[t("img",{staticStyle:{"max-width":"100%"},attrs:{src:e.imgUrl,alt:""}})])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-6 text-center"},[t("label",[e._v("实时图片")])]),t("div",{staticClass:"col-6 text-center"},[t("label",[e._v("报警图片")])])])])]},proxy:!0}])})},I=[],S=a("5a0c"),D=a.n(S),x={name:"AlertDetailDlg",components:{SimpleModalDlg:f["a"]},data:function(){return{misReportId:r["a"].randomId("check"),isMisreported:!1,alertRec:null,imgUrl:null,rtImgUrl:null}},props:{modalId:{type:String,required:!0},alertId:{type:Number,required:!0}},computed:{},methods:{formatDateTime:function(e){return D()(new Date(e)).format("YYYY年MM月DD日 HH:mm:ss")},loadRtImage:function(){var e=this;if(this.alertId){var t="alert/alerts/get_real_time_image/?alert_ids=".concat(this.alertId);d["a"].apiAjaxGet(t,{},(function(t){0===t.code&&(e.rtImgUrl=r["a"].getImageUrl(t.data[e.alertId]))}),r["a"].defaultApiErrorHandler(t,""))}},loadRecord:function(){var e=this;if(this.alertId){var t="alert/alerts2/".concat(this.alertId,"/"),a={};d["a"].apiAjaxGet(t,a,(function(t){console.log(t.data),e.alertRec=t.data,e.imgUrl=r["a"].getImageUrl(e.alertRec.img),e.isMisreported=e.alertRec.is_misreported}),r["a"].defaultApiErrorHandler(t,""))}},updateMisreported:function(){var e=this;if(this.alertId){var t="alert/alerts2/".concat(this.alertId,"/"),a={is_misreported:this.isMisreported};d["a"].apiAjaxPatch(t,a,(function(){e.$emit("alert-status-changed",e.alertId)}),r["a"].defaultApiErrorHandler(t,""))}}},watch:{alertId:function(){this.loadRecord(),this.loadRtImage()},isMisreported:function(){this.updateMisreported()}},mounted:function(){}},y=x,O=Object(p["a"])(y,w,I,!1,null,null,null),R=O.exports,C=a("8cba"),T=function(){var e=this,t=e._self._c;return t("div",[t("SimpleSelect",{attrs:{itemList:e.itemList,label:e.label},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)},_=[],P=(a("6b54"),a("4d92")),j={name:"DbSelectFilter",components:{SimpleSelect:P["a"]},data:function(){return{value:-1,itemList:[]}},props:{endpoint:{type:String,required:!0},label:{type:String,required:!0},modelValue:{type:String},field:{type:String,required:!0},descent:{type:Boolean,required:!1,default:!1},defaultIndex:{type:Number,require:!1,default:-1},nullItemText:{type:String,required:!1,default:""}},emits:["update:modelValue"],watch:{modelValue:function(e){this.value=this.fromInitValue(e)},value:function(){this.emitEvent()}},methods:{emitEvent:function(){var e="";return this.value>0&&(e=this.itemList[this.value]),this.$emit("update:modelValue",e)},fromInitValue:function(e){return e?this.itemList.indexOf(e):0},getOptionList:function(){var e=this,t=this.field,a={limit:500,by:t,count:"id",ordering:"".concat(this.descent?"-":"").concat(t)};d["a"].apiAjaxGet(this.endpoint,a,(function(a){e.itemList=a.data.results.map((function(e){return e[t]&&e[t].toString()})),e.itemList.unshift(e.nullItemText),e.defaultIndex<e.itemList.length&&(e.value=e.defaultIndex+1)}),r["a"].defaultApiErrorHandler(this.endpoint,"loadData failed"),(function(){}),{},!0)}},mounted:function(){this.getOptionList(),this.value=this.fromInitValue(this.modelValue)}},A=j,k=Object(p["a"])(A,T,_,!1,null,null,null),M=k.exports;function L(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?L(Object(a),!0).forEach((function(t){Object(o["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):L(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}window.alertRowSelected=function(e){window.currAlertId=e};var F={name:"ModuleAlerts",components:{ApiDataTable:n["a"],AlertDeleteDlg:v,AlertDetailDlg:R,DateTimeRangePicker:C["a"],DbSelectFilter:M,SimpleSelect:P["a"]},data:function(){return{alertListTableId:r["a"].randomId("tableId"),alertDeleteDlgId:r["a"].randomId("modalId"),alertDetailDlgId:r["a"].randomId("modalId"),tableComp:null,currAlertId:0,dateTimeRange:C["a"].getDefaultRange(),isMisReported:0,channelNo:"",algorithm:""}},computed:{tableHandlers:function(){return{setComponent:this.tableSetComponent,getEndpoint:this.tableGetEndPoint,getParams:this.tableGetParams,tableRowFormatter:this.tableRowFormatter,getColSpecs:this.tableGetColSpecs,rowStyle:this.rowStyle,getDataList:this.getDataList,onPageLoaded:this.onPageLoaded}}},methods:{tableSetComponent:function(e){this.tableComp=e},tableRowFormatter:function(e){return{id:e.id,date_time:D()(new Date(e.date_time)).format("YYYY-MM-DDTHH:mm:ss"),algorithm:e.algorithm.name_ch,cno:e.channel.cno,ch_name:e.channel.name,ch_site:e.channel.site,rt_img:"实时图片",img:'<a href="javascript:alertRowSelected('.concat(e.id,");$('#").concat(this.alertDetailDlgId,"').modal('show')\">\n          <img src=\"").concat(r["a"].getImageUrl(e.img),'" style="max-height: 50px;max-width: 80px;">\n          </a>\n        '),is_misreported:e.is_misreported?"是":"否",operation:'\n          <a href="javascript:alertRowSelected('.concat(e.id,");$('#").concat(this.alertDeleteDlgId,"').modal('show')\">删除</a>\n        ")}},tableGetParams:function(){var e={ordering:"-date_time"};return this.dateTimeRange&&(e=E(E({},e),C["a"].rangeToFilter(this.dateTimeRange))),this.channelNo&&(e["channel__cno"]=this.channelNo),this.algorithm&&(e["algorithm__name_ch"]=this.algorithm),1===this.isMisReported?e["is_misreported"]=!0:2===this.isMisReported&&(e["is_misreported"]=!1),e},tableGetEndPoint:function(){return"alert/alerts2/"},tableGetColSpecs:function(){var e=[{field:"id",title:"ID"},{field:"date_time",title:"时间"},{field:"algorithm",title:"算法"},{field:"cno",title:"通道编号"},{field:"ch_name",title:"通道名称"},{field:"ch_site",title:"通道位置"},{field:"rt_img",title:"实时图片"},{field:"img",title:"报警图片"},{field:"is_misreported",title:"误报"},{field:"operation",title:"操作"}];return e},onTableSelectionChanged:function(){},reloadTable:function(){this.tableComp&&this.tableComp.getOnePage(),this.onTableSelectionChanged()},onPageLoaded:function(e,t){var a=this,l="alert/alerts/get_real_time_image/?alert_ids=".concat(t.map((function(e){return e.id})).join(","));console.log("onPageLoaded",t,l),d["a"].apiAjaxGet(l,{},(function(e){0===e.code&&t.forEach((function(t,l){t.id in e.data&&a.tableComp.table.bootstrapTable("updateCell",{index:l,field:"rt_img",value:'<a href="javascript:alertRowSelected('.concat(t.id,");$('#").concat(a.alertDetailDlgId,"').modal('show')\">\n                  <img src=\"").concat(r["a"].getImageUrl(e.data[t.id]),'" style="max-height: 50px;max-width: 80px;">\n                  </a>\n                ')})}))}),r["a"].defaultApiErrorHandler(l,""))},rowStyle:function(){var e={};return e},getDataList:function(e){return e.data.results},beforeModalShow:function(){console.log("beforeModalShow"),this.currAlertId=window.currAlertId},onAlertDeleted:function(){this.reloadTable()},onAlertStatusChanged:function(){this.reloadTable()}},watch:{dateTimeRange:function(){this.reloadTable()},channelNo:function(){this.reloadTable()},algorithm:function(){this.reloadTable()},isMisReported:function(){this.reloadTable()}},mounted:function(){var e=this;c()("#".concat(this.alertDeleteDlgId)).on("show.bs.modal",(function(){e.beforeModalShow()})),c()("#".concat(this.alertDetailDlgId)).on("show.bs.modal",(function(){e.beforeModalShow()}))}},q=F,H=Object(p["a"])(q,l,i,!1,null,null,null);t["default"]=H.exports},f217:function(e,t,a){"use strict";var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid w-100 overflow-auto"},[t("table",{staticClass:"text-nowrap",attrs:{id:e.tableId,"data-height":e.dataHeight,"data-classes":"table table-striped table-sm","data-sortable":"true","data-click-to-select":"true","data-pagination":e.pagination,"data-side-pagination":"server","data-detail-view":e.detailView,"data-detail-view-icon":"true","data-detail-view-by-click":"true","data-show-footer":e.showFooter}})])},i=[],o=(a("8e6e"),a("456d"),a("75fc")),n=(a("ac6a"),a("7514"),a("bd86")),r=(a("c5f6"),{transCellSelected2ItemSelected:function(e,t,a,l){var i=0,o=null;l&&(i=l.id,o=l),"selectedId"in e&&(e.selectedId=i),"selectedRow"in e&&(e.selectedRow=o),e.$emit("itemSelected",i,o)}}),s=a("1157"),c=a.n(s),d=a("0be2");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"ApiDataTable",components:{},data:function(){return{table:null,listSize:10,listOffset:0,searchText:"",sortOrder:"",sortField:"",timeoutIdReload:0,selectedIds:[],selectedRows:[]}},props:{tableId:{type:String,required:!1,default:"api_data_table"},handlers:{type:Object,required:!0},dataHeight:{type:Number,required:!1,default:500},loadData:{type:Boolean,required:!1,default:!0},inModal:{type:Boolean,required:!1,default:!1},showSearch:{type:Boolean,required:!1,default:!0},showFooter:{type:Boolean,required:!1,default:!1},detailView:{type:Boolean,required:!1,default:!0},pagination:{type:Boolean,required:!1,default:!0},checkbox:{type:Boolean,required:!1,default:!1}},methods:{detailFormatter:function(e,t){return"undefined"===typeof this.handlers.detailFormatter?this.defaultDetailFormatter(e,t):this.handlers.detailFormatter(e,t)},rowStyle:function(e,t){return"undefined"===typeof this.handlers.rowStyle?{}:this.handlers.rowStyle(e,t)},defaultDetailFormatter:function(e,t){var a=[];a.push('<div class="text-left"><pre>');var l=JSON.stringify(t,null,4);return a.push(l),a.push("</pre></div>"),a.join("")},getOnePage:function(){var e=this;console.log("getOnePage");var t=this.handlers.getEndpoint();if(t){var a={limit:this.listSize,offset:this.listOffset,search:this.searchText,order:this.sortOrder,order_field:this.sortField};if(Object.assign(a,this.getSortParam()),"getParams"in this.handlers&&this.handlers.getParams){var l=this.handlers.getParams();l&&(a=h(h({},a),l))}d["a"].apiAjaxGet(t,a,(function(t){if(0===t.code){var a=t.data,l=e.handlers.getDataList?e.handlers.getDataList(t):a.rows,i=[];for(var o in l){var n=e.handlers.tableRowFormatter(l[o],o,e);i.push(n)}e.table.bootstrapTable("load",i),e.table.bootstrapTable("refreshOptions",{totalRows:a.count}),e.handlers.onPageLoaded&&e.handlers.onPageLoaded(e,i)}else console.log("Got getOnePage error: "),console.log(t.data)}),(function(e){console.log(e)}),(function(){e.onTableSelectionChanged(),e.onTableDblClickCell(null,null,null,null)}))}},onSearch:function(e,t){this.searchText=t,console.log("onSearch",t)},onPageChange:function(e,t,a){console.log("onPageChange: ",t,a),this.listSize=a,this.listOffset=(t-1)*this.listSize,this.searchText=this.table.bootstrapTable("getOptions").searchText,this.getOnePage()},getSortParam:function(){var e=this.table.bootstrapTable("getOptions"),t=e.sortName,a=e.sortOrder;if(e.sortName)t=e.sortName,a=e.sortOrder;else{var l=e.columns[0].find((function(e){return"default-sort-order"in e}));if(!l)return{};t=l.field,a=l["default-sort-order"]}var i=t,o=e.columns[0].find((function(e){return e.field===t}));return"sort-name"in o&&(i=o["sort-name"]),i={asc:"",desc:"-"}[a]+i,console.log("onSort: ".concat(t,", ").concat(a,", ").concat(i),e),{ordering:i}},onTableDblClickCell:function(e,t,a,l){console.log("cellSelected",t,a),this.$emit("cellSelected",t,a,l)},getRowIndex:function(e,t){var a=-1,l=this.table.bootstrapTable("getData");return l.forEach((function(l,i){l[e]===t&&(a=i)})),a},refreshSelectedRow:function(e,t,a){var l=this.getRowIndex(e,t);l>=0&&this.table.bootstrapTable("showRow",{index:l});var i=this.getRowIndex(e,a);i>=0&&this.table.bootstrapTable("showRow",{index:i})},delayToReleadTable:function(e){var t=this;this.timeoutIdReload&&(clearTimeout(this.timeoutIdReload),this.timeoutIdReload=0),e&&(this.listOffset=0),this.timeoutIdReload=setTimeout((function(){t.timeoutIdReload=0,t.getOnePage()}),500)},onTableSelectionChanged:function(){this.selectedRows=this.table.bootstrapTable("getSelections"),this.selectedIds=this.selectedRows.map((function(e){return e.id})),console.log("onTableSelectionChanged: (".concat(this.selectedIds.length,"): ").concat(this.selectedIds)),this.$emit("selection-changed",this.selectedIds,this.selectedRows)},setEventForCheckbox:function(){this.checkbox&&(this.table.on("check.bs.table",this.onTableSelectionChanged),this.table.on("uncheck.bs.table",this.onTableSelectionChanged),this.table.on("check-all.bs.table",this.onTableSelectionChanged),this.table.on("uncheck-all.bs.table",this.onTableSelectionChanged))}},computed:{},watch:{loadData:function(e){e&&this.getOnePage()},checkbox:function(){this.setEventForCheckbox()}},mounted:function(){this.handlers.setComponent(this);var e=this.handlers.getColSpecs();this.checkbox&&(e=[{field:"selected",checkbox:!0,default:!1}].concat(Object(o["a"])(e)));var t=c()("#".concat(this.tableId));this.table=t,console.log("this.table",this.table,t),t.bootstrapTable({columns:e,pageNumber:1,pageSize:this.listSize,pageList:"[10, 20, 50, 100]",paginationHAlign:"right",paginationDetailHAlign:"left",detailFormatter:this.detailFormatter,rowStyle:this.rowStyle,search:this.showSearch,showJumpTo:!0}),t.on("search.bs.table",this.onSearch),t.on("sort.bs.table",this.getOnePage),t.on("page-change.bs.table",this.onPageChange),t.on("dbl-click-cell.bs.table",this.onTableDblClickCell),this.setEventForCheckbox(),this.loadData&&this.getOnePage()},transCellSelected2ItemSelected:function(e,t,a,l){r.transCellSelected2ItemSelected(e,t,a,l)}},m=f,g=a("2877"),p=Object(g["a"])(m,l,i,!1,null,"4548f32c",null);t["a"]=p.exports}}]);