(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4314b3ac"],{"405b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row ml-2 mb-2"},[t("div",{staticClass:"w-100",staticStyle:{display:"flex","justify-content":"space-between"}},[t("SimpleSelect",{attrs:{itemList:e.algNameChs},model:{value:e.currAlgIndex,callback:function(t){e.currAlgIndex=t},expression:"currAlgIndex"}}),t("button",{staticClass:"btn btn-primary mr-4 btn-sm btn-iview-size",on:{click:e.saveCurrent}},[e._v("保存")])],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-xl-2 algorithm-config-block"},[t("div",{staticClass:"card w-100"},[e._m(0),t("div",{staticClass:"card-body py-1 px-2 col algorithm-config-block-body alg-left-panel-flat"},[t("div",{staticClass:"ml-2"},[t("label",{staticClass:"mt-1 field-label",attrs:{for:"id-channel-alg-config"}},[e._v("开启")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.algStatus[e.selectedCno-1].configured,expression:"algStatus[selectedCno-1].configured"}],staticClass:"ml-1",attrs:{type:"radio",id:"id-channel-alg-config",name:"channelAlgConfig"},domProps:{value:!0,checked:e._q(e.algStatus[e.selectedCno-1].configured,!0)},on:{change:function(t){return e.$set(e.algStatus[e.selectedCno-1],"configured",!0)}}}),t("label",{staticClass:"ml-2 mt-1 field-label",attrs:{for:"id-channel-alg-unconfig"}},[e._v("不开启")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.algStatus[e.selectedCno-1].configured,expression:"algStatus[selectedCno-1].configured"}],staticClass:"ml-2",attrs:{type:"radio",id:"id-channel-alg-unconfig",name:"channelAlgConfig"},domProps:{value:!1,checked:e._q(e.algStatus[e.selectedCno-1].configured,!1)},on:{change:function(t){return e.$set(e.algStatus[e.selectedCno-1],"configured",!1)}}})]),t("ChannelSelectionGrid",{attrs:{channelNames:e.channelNames,channelConfigured:e.channelConfigured,channelStatusChanged:e.channelStatusChanged},model:{value:e.selectedCno,callback:function(t){e.selectedCno=t},expression:"selectedCno"}})],1)])]),t("div",{staticClass:"col-xl-10 pl-0"},[t("div",{staticClass:"w-100 overflow-auto container-fluid"},[t("ChannelAlgConfigPanelFlat",{attrs:{algDisplayName:"来自于算法配置",channelImage:e.channelImage,modalShown:e.modalShown,defaultParameters:e.defaultParameters},model:{value:e.algStatus[e.selectedCno-1],callback:function(t){e.$set(e.algStatus,e.selectedCno-1,t)},expression:"algStatus[selectedCno-1]"}})],1)])]),t("Toast",{attrs:{toastId:e.toastId,text:"算法配置保存成功！"}})],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-header py-1 px-2 dash-chart-title"},[t("span",{staticClass:"card-head-title"},[e._v("请选择通道")])])}],l=(a("8e6e"),a("2909")),i=(a("7f7f"),a("ade3")),r=(a("6c7b"),a("ac6a"),a("456d"),a("fa7d")),o=a("f953"),c=a("0be2"),d=a("8715"),u=(a("1157"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"row"},[t("div",{staticClass:"col-lg-7 ml-0 pl-0 algorithm-config-block"},[t("div",{staticClass:"card w-100"},[e._m(0),t("div",{staticClass:"card-body py-1 px-2 col algorithm-config-block-body alg-mid-panel-flat"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.status.configured&&e.showRoi,expression:"status.configured && showRoi"}],staticClass:"row mt-2"},[t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("div",{staticClass:"row mx-0"},[t("a",{staticClass:"mr-2 icon-anchor",attrs:{title:e.roiDrawing?"完成":"新建多边形监控区域",href:"javascript:void(0);"},on:{click:function(t){e.roiDrawing=!e.roiDrawing}}},[t("IconFont",{class:e.roiDrawing?"duobianxing-selected":"duobianxing-unselected",attrs:{iconName:"icon-duobianxingxuanze"}})],1),t("a",{staticClass:"mr-2 icon-anchor",attrs:{title:"清除所有选区(全域监控)",href:"javascript:void(0);"},on:{click:function(t){e.status.roi_region=null,e.roiDrawing=!1}}},[t("IconFont",{staticClass:"shanchu-button",attrs:{iconName:"icon-shanchu"}})],1)])])]),t("div",{staticClass:"row mx-0 mt-2"},[t("div",{staticClass:"col px-0"},[t("RoiDrawPanel",{attrs:{isDrawing:e.roiDrawing,imgSrc:e.channelImage,panelShown:e.modalShown&&e.status.configured},model:{value:e.status.roi_region,callback:function(t){e.$set(e.status,"roi_region",t)},expression:"status.roi_region"}})],1)])])])])])]),t("div",{staticClass:"col-xl-5 ml-0 pl-0 algorithm-config-block"},[t("div",{staticClass:"card w-100"},[e._m(1),t("div",{staticClass:"card-body py-1 px-2 col algorithm-config-block-body alg-right-panel-flat"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.status.configured,expression:"status.configured"}],staticClass:"row mt-2 pb-2"},[t("span",{staticClass:"field-label pl-3"},[e._v("基本参数：")]),t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[e._m(2),t("div",{staticClass:"col"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.status.analyze_interval,expression:"status.analyze_interval",modifiers:{number:!0}}],staticClass:"ml-2",attrs:{type:"number",step:"500"},domProps:{value:e.status.analyze_interval},on:{input:function(t){t.target.composing||e.$set(e.status,"analyze_interval",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("span",{})])]),t("div",{staticClass:"row mt-1"},[e._m(3),t("div",{staticClass:"col"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.status.alert_interval,expression:"status.alert_interval",modifiers:{number:!0}}],staticClass:"ml-2",attrs:{type:"number",step:"1"},domProps:{value:e.status.alert_interval},on:{input:function(t){t.target.composing||e.$set(e.status,"alert_interval",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),t("div",{staticClass:"row mt-1"},[e._m(4),t("div",{staticClass:"col"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.status.alert_threshold,expression:"status.alert_threshold",modifiers:{number:!0}}],staticClass:"ml-2",attrs:{type:"number",step:"0.05"},domProps:{value:e.status.alert_threshold},on:{input:function(t){t.target.composing||e.$set(e.status,"alert_threshold",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("span",{})])])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.status.configured,expression:"status.configured"}],staticClass:"row mt-2 pb-2"},[t("div",{staticClass:"container-fluid"},[e._m(5),t("div",{staticClass:"row"},[t("div",{staticClass:"col collapse show",attrs:{id:"dateTimeSetting"}},[t("div",{staticClass:"w-100",staticStyle:{height:"400px"}},[t("WeekDatetimePicker",{model:{value:e.status.alert_times,callback:function(t){e.$set(e.status,"alert_times",t)},expression:"status.alert_times"}})],1)])])])])])])])])}),h=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-header py-1 px-2 dash-chart-title"},[t("span",{staticClass:"card-head-title"},[e._v("请绘制ROI（监控区域）")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-header py-1 px-2 dash-chart-title"},[t("span",{staticClass:"card-head-title"},[e._v("请配置监控参数")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-4 text-right"},[t("span",{staticClass:"field-required"},[e._v("分析间隔(毫秒)")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-4 text-right"},[t("span",{staticClass:"field-required"},[e._v("报警间隔(秒)")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-4 text-right"},[t("span",{staticClass:"field-required"},[e._v("报警阈值(0-1)")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"row mb-1"},[t("span",{staticClass:"field-label pl-3 pt-1"},[e._v("布控时间：")])])}],f=a("f62b"),m=a("4865"),g=a("d940");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C={name:"ChannelAlgConfigPanelFlat",components:{WeekDatetimePicker:f["a"],RoiDrawPanel:m["a"],IconFont:g["a"]},data:function(){return{dateTimeSettingShown:!1,status:{},algDisplayNamePrev:"",roiDrawing:!1}},props:{defaultParameters:{type:Object,required:!1,default:function(){return{}}},showTimeToggle:{type:Boolean,required:!1,default:!0},showTitle:{type:Boolean,required:!1,default:!0},showRoi:{type:Boolean,required:!1,default:!0},channelImage:{type:String,required:!1,default:""},modalShown:{type:Boolean,required:!1,default:!1},algDisplayName:{type:String,required:!0},modelValue:{type:Object,required:!0}},model:{prop:"modelValue",event:"input"},computed:{},methods:{restoreDefault:function(){var e=v({},this.status);for(var t in this.defaultParameters)e[t]=this.defaultParameters[t];this.status=e}},watch:{modelValue:function(e){console.log("modelValue changed",e),this.algDisplayNamePrev=this.algDisplayName,this.status=e},status:{handler:function(){parseInt(this.status.analyze_interval)<1e3&&(this.status.analyze_interval="1000"),parseInt(this.status.alert_interval)<30&&(this.status.alert_interval="30"),parseFloat(this.status.alert_threshold)<0&&(this.status.alert_threshold="0"),parseFloat(this.status.alert_threshold)>1&&(this.status.alert_threshold="1"),this.$emit("input",this.status)},deep:!0},algDisplayName:function(){this.roiDrawing=!1}},mounted:function(){this.status=v({},this.modelValue)}},b=C,w=(a("d409"),a("2877")),y=Object(w["a"])(b,u,h,!1,null,null,null),_=y.exports,S=a("6da7"),x=a("f121"),A=a("4d92"),O=a("8cbb");function I(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?I(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var j={name:"AlgorithmAlgConfigDlg",components:{SimpleModalDlg:o["a"],ChannelAlgConfigPanelFlat:_,ChannelSelectionGrid:S["a"],SimpleSelect:A["a"]},data:function(){return{toastId:r["a"].randomId("toast"),algorithmInfo:d["a"].getAlgNameIcons(),algNames:Object.keys(d["a"].getAlgNameIcons()),algNameChs:Object.keys(d["a"].getAlgNameIcons()).map((function(e){return d["a"].getAlgNameIcons()[e].name_ch+"识别"})),algStatus:new Array(x["a"].maxChannels).fill(0).map((function(){return P({configured:!1},d["a"].defaultAlgParams)})),dateTimeSettingShown:!1,channelImage:"",modalShown:!1,defaultParameters:{},selectedCno:1,channelConfigured:new Array(x["a"].maxChannels).fill(!1),channelIds:new Array(x["a"].maxChannels).fill(0),channelNames:new Array(x["a"].maxChannels).fill(""),channelStatusOld:new Array(x["a"].maxChannels).fill(""),channelStatusChanged:new Array(x["a"].maxChannels).fill(!1),currAlg:{},currAlgIndex:0,updated:!1}},props:{},computed:{},methods:{saveCurrent:function(){var e=this,t=this.selectedCno,a=this.channelIds[this.selectedCno-1],n="channel/channels/".concat(a,"/config_single_alg/"),s={alg_name:this.currAlg.name,status:this.algStatus[t-1]};c["a"].apiAjaxPost(n,s,(function(n){0===n.code?(O["a"].showToast(e.toastId),e.$emit("alg-channel-single-saved")):alert("算法配置保存失败(".concat(n.code,"): ").concat(n.message)),e.loadAlgorithmChannels(a,t)}),r["a"].defaultApiErrorHandler(n,""))},recordToStatus:function(e){var t={};return Object.keys(this.defaultParameters).forEach((function(a){t[a]=e[a]})),t.configured=!0,t},loadChannelImage:function(){var e=this;console.log("loadChannelImage",this.selectedCno,this.channelIds);var t=this.channelIds[this.selectedCno-1];if(t){var a="channel/channels/".concat(t,"/get_real_time_image/");c["a"].apiAjaxGet(a,{},(function(t){0===t.code&&t.data&&(e.channelImage=r["a"].getImageUrl(t.data.filename),e.modalShown=!0,e.$forceUpdate())}),r["a"].defaultApiErrorHandler(a,""))}},loadDefaultParameters:function(){var e=this,t="algorithm/algorithmdefaultparameters/get_default/";c["a"].apiAjaxGet(t,{},(function(t){if(0===t.code)if(t.data.length>0){for(var a in e.defaultParameters={},d["a"].defaultAlgParams)e.defaultParameters[a]=t.data[0][a];for(var n in e.algStatus)e.algStatus[n].configured||Object.assign(e.algStatus[n],e.defaultParameters)}else e.defaultParameters=P({},d["a"].defaultAlgParams)}),r["a"].defaultApiErrorHandler(t,""))},loadAlgorithmChannels:function(e,t){var a=this,n="algorithm=".concat(this.currAlg.id);e&&(n="".concat(n,"&channel=").concat(e));var s="channel/channelalgorithms2/?".concat(n);c["a"].apiAjaxGet(s,{},(function(n){if(0===n.code){for(var s in a.channelStatusOld=Object(l["a"])(a.channelStatusOld),a.algStatus)e&&parseInt(s)!==t-1||(Object.assign(a.algStatus[s],P({configured:!1},a.defaultParameters)),a.channelStatusOld[s]=JSON.stringify(a.algStatus[s]));n.data.forEach((function(e){a.algStatus[e.channel.cno-1]=a.recordToStatus(e),a.channelStatusOld[e.channel.cno-1]=JSON.stringify(a.algStatus[e.channel.cno-1])})),a.$forceUpdate()}else console.log("获取通道算法失败！")}),r["a"].defaultApiErrorHandler(s,""))},loadChannels:function(){var e=this,t="channel/channels/";c["a"].apiAjaxGet(t,{},(function(t){if(0===t.code){for(var a in e.channelNames=new Array(x["a"].maxChannels).fill(""),e.channelIds=Object(l["a"])(e.channelIds),t.data)e.channelNames[t.data[a].cno-1]=t.data[a].name,e.channelIds[t.data[a].cno-1]=t.data[a].id;console.log("Channel loaded2",e.channelIds,e.channelNames)}}),r["a"].defaultApiErrorHandler(t,""))},currAlgChanged:function(){console.log("currAlgChanged",this.currAlg),this.loadChannels(),this.loadDefaultParameters(),this.loadAlgorithmChannels()},getCurrAlgByIndex:function(e){var t=Object.keys(this.algorithmInfo)[e];this.currAlg={id:this.algorithmInfo[t].id,name:t,name_ch:this.algorithmInfo[t].name_ch}},onStatusChanged:function(){var e=this;this.channelConfigured=this.algStatus.map((function(e){return e.configured})),this.channelStatusChanged=this.algStatus.map((function(t,a){return JSON.stringify(t)!==e.channelStatusOld[a]}))}},watch:{selectedCno:function(){console.log("selectedCno changed",this.selectedCno),this.loadChannelImage()},algStatus:{handler:function(){this.onStatusChanged()},deep:!0},channelStatusOld:function(){this.onStatusChanged()},channelIds:function(){console.log("channelIds",this.channelIds),this.loadChannelImage()},modalShown:function(){},currAlgIndex:function(){this.modalShown=!1,this.getCurrAlgByIndex(this.currAlgIndex),this.currAlgChanged()}},beforeUpdate:function(){this.updated||(this.updated=!0,window.currAlg?this.currAlg=P({},window.currAlg):this.getCurrAlgByIndex(0),this.currAlgIndex=Object.keys(this.algorithmInfo).indexOf(this.currAlg.name),this.currAlgChanged())},updated:function(){},beforeDestroy:function(){this.modalShown=!1},mounted:function(){}},N=j,k=(a("abd5"),Object(w["a"])(N,n,s,!1,null,null,null));t["default"]=k.exports},"4d92":function(e,t,a){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"selected"}],staticClass:"form-control font-iview-size control-sm",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selected=t.target.multiple?a:a[0]}}},e._l(e.itemList,(function(a,n){return t("option",{key:e.uniqueId+n,domProps:{value:"item"===e.valueType?a:n}},[e._v(e._s("field"===e.showType?a[e.showField]:a))])})),0)])},s=[],l=a("fa7d"),i={name:"SimpleSelect",components:{},data:function(){return{uniqueId:l["a"].randomString(),selected:null}},props:{label:{type:String,required:!1,default:""},modelValue:{required:!1,default:-1},showType:{type:String,required:!1,default:"item"},valueType:{type:String,required:!1,default:"index"},showField:{type:String,required:!1,default:""},itemList:{type:Array,required:!0},required:{type:Boolean,required:!1,default:!1}},model:{prop:"modelValue",event:"input"},computed:{},methods:{},watch:{modelValue:function(){this.selected=this.modelValue},selected:function(){this.$emit("input",this.selected)}},mounted:function(){this.selected=this.modelValue},unmounted:function(){},created:function(){}},r=i,o=a("2877"),c=Object(o["a"])(r,n,s,!1,null,null,null);t["a"]=c.exports},5289:function(e,t,a){e.exports=a.p+"img/channel-configured.b36629f9.png"},"6da7":function(e,t,a){"use strict";a("6c7b");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"alg-channel-list",attrs:{id:"list-tab",role:"tablist"}},e._l(new Array(e.maxChannels).fill(0).map((function(e,t){return t+1})),(function(n){return t("div",{key:n,staticClass:"text-center alg-channel-item",on:{click:function(t){return e.channelClicked(n)}}},[t("img",{directives:[{name:"show",rawName:"v-show",value:e.channelConfigured[n-1],expression:"channelConfigured[item-1]"}],class:"alg-channel-icon "+(n===e.selectedCno?"alg-channel-icon-selected ":" ")+(e.channelNames[n-1]?" ":"alg-channel-icon-invalid "),attrs:{src:a("5289"),alt:"通道"+{item:n}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:!e.channelConfigured[n-1],expression:"!channelConfigured[item-1]"}],class:"alg-channel-icon "+(n===e.selectedCno?"alg-channel-icon-selected ":" ")+(e.channelNames[n-1]?" ":"alg-channel-icon-invalid "),attrs:{src:a("cc1e"),alt:"通道"+{item:n}}}),t("div",{staticClass:"text-center"},[t("IconFont",{class:e.channelNames[n-1]?e.channelStatusChanged[n-1]?"red-dot":"green-dot":"gray-dot",attrs:{iconName:"icon-dot"}}),e._v("\n      "+e._s("".concat(n," ")+(e.channelNames[n-1]?e.channelNames[n-1]:"(未添加)"))+"\n    ")],1)])})),0)},s=[],l=(a("c5f6"),a("f121")),i={name:"ChannelSelectionGrid",components:{},data:function(){return{maxChannels:l["a"].maxChannels}},props:{channelConfigured:{type:Array,required:!0},channelStatusChanged:{type:Array,required:!0},channelNames:{type:Array,required:!0},selectedCno:{type:Number,required:!0}},model:{prop:"selectedCno",event:"input"},methods:{channelClicked:function(e){this.channelNames[e-1]&&e!==this.selectedCno&&this.$emit("input",e)}},watch:{selectedCno:function(){}},mounted:function(){}},r=i,o=(a("87ae"),a("2877")),c=Object(o["a"])(r,n,s,!1,null,null,null);t["a"]=c.exports},"87ae":function(e,t,a){"use strict";a("b8e9")},abd5:function(e,t,a){"use strict";a("f5ea")},b8e9:function(e,t,a){},c429:function(e,t,a){},cc1e:function(e,t,a){e.exports=a.p+"img/channel-not-configured.4da3f0ed.png"},d409:function(e,t,a){"use strict";a("c429")},f5ea:function(e,t,a){}}]);