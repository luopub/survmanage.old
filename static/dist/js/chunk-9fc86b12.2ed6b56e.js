(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9fc86b12"],{"2e2d":function(e,t,a){"use strict";a("b1e1")},3846:function(e,t,a){a("9e1e")&&"g"!=/./g.flags&&a("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:a("0bfb")})},4447:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row w-100 ml-1 my-2"},[t("div",{staticClass:"row ml-1 my-2"},[t("button",{staticClass:"btn btn-primary btn-sm btn-iview-size",attrs:{disabled:e.usedNos.length===e.availNos.length,"data-toggle":"modal","data-target":"#"+e.channelEditDlgId}},[e._v("添加通道")]),t("button",{staticClass:"btn btn-light ml-4 btn-sm btn-iview-size",attrs:{disabled:!0}},[e._v("已用通道 "+e._s(e.usedNos.length)+"/"+e._s(e.availNos.length))])]),t("div",{staticClass:"row w-100 mt-4"},[t("ApiDataTable",{attrs:{handlers:e.tableHandlers,tableId:"channelListTableId",dataHeight:400,showWaitingDlg:!1,showSearch:!1,detailView:!1}})],1),t("ChannelEditDlg",{attrs:{modalId:e.channelEditDlgId,channelId:e.currRowChannelId,availNos:e.availNos,freeNos:e.freeNos},on:{"channel-saved":e.onChannelSaved,"channel-save-failed":e.onChannelSaveFailed}}),t("ChannelDeleteDlg",{attrs:{modalId:e.channelDeleteDlgId,channelId:e.currRowChannelId,cno:e.currRowChannelNo},on:{"channel-deleted":e.onChannelDeleted}})],1),t("Toast",{attrs:{toastId:e.toastId,text:e.toastText,iconDacha:e.iconDacha}})],1)},i=[],o=(a("ac6a"),a("7f7f"),a("55dd"),a("2909")),l=a("f217"),s=a("fa7d"),c=a("1157"),r=a.n(c),d=function(){var e=this,t=e._self._c;return t("div",[t("SimpleModalDlg",{attrs:{modalId:e.modalId,title:e.channelId?"编辑通道":"添加通道",content:"",defaultButtonText:"取消",button2Text:"保存",button2Action:e.button2Action,dialogWidth:600},scopedSlots:e._u([{key:"bodyPost",fn:function(){return[t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("span",{staticClass:"field-label"},[e._v("通道ID：")])]),t("div",{staticClass:"col mb-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.cid,expression:"cid"}],staticClass:"mr-1 channel-edit-input",attrs:{disabled:!0},domProps:{value:e.cid},on:{input:function(t){t.target.composing||(e.cid=t.target.value)}}})])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("span",{staticClass:"field-label"},[e._v("通道号：")])]),t("div",{staticClass:"col mb-1"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.cno,expression:"cno"}],attrs:{disabled:e.channelId>0,name:"selectList"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.cno=t.target.multiple?a:a[0]}}},e._l(e._freeNos,(function(a,n){return t("option",{key:e.modalId+e.uniqueId+n},[e._v(e._s(a))])})),0)])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("span",{staticClass:"field-label field-required"},[e._v("通道名称：")])]),t("div",{staticClass:"col mb-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"mr-1 channel-edit-input",domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),t("IconFont",{class:e.nameValid?"dagou-icon":"dacha-icon",attrs:{iconName:e.nameValid?"icon-dagouyouquan":"icon-cuowuguanbiquxiao-yuankuang"}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("span",{staticClass:"field-label field-required"},[e._v("通道位置：")])]),t("div",{staticClass:"col mb-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.site,expression:"site"}],staticClass:"mr-1 channel-edit-input",domProps:{value:e.site},on:{input:function(t){t.target.composing||(e.site=t.target.value)}}}),t("IconFont",{class:e.siteValid?"dagou-icon":"dacha-icon",attrs:{iconName:e.siteValid?"icon-dagouyouquan":"icon-cuowuguanbiquxiao-yuankuang"}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("span",{staticClass:"field-label field-required"},[e._v("URL：")])]),t("div",{staticClass:"col mb-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],staticClass:"mr-1 channel-edit-input",domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}}),t("IconFont",{class:e.urlValid?"dagou-icon":"dacha-icon",attrs:{iconName:e.urlValid?"icon-dagouyouquan":"icon-cuowuguanbiquxiao-yuankuang"}})],1)])])]},proxy:!0}])})],1)},u=[],h=(a("6b54"),a("c5f6"),a("f953")),f=a("0be2"),b=a("69a0"),m=a.n(b),p={name:"ChannelEditDlg",components:{SimpleModalDlg:h["a"]},data:function(){return{uniqueId:s["a"].randomString(),cno:"",cid:"",name:"",site:"",url:""}},props:{modalId:{type:String,required:!0},channelId:{type:Number,required:!0},availNos:{type:Array,required:!0},freeNos:{type:Array,required:!0}},computed:{cnoValid:function(){return!!this.cno},cidValid:function(){return 32===this.cid.trim().length},nameValid:function(){return this.name.trim().length>0},siteValid:function(){return this.site.length>0},urlValid:function(){return this.url.length>=10},_freeNos:function(){return this.channelId>0?[].concat(Object(o["a"])(this.freeNos),[this.cno]):this.freeNos}},methods:{channelSaveFailed:function(e){this.$emit("channel-save-failed",e)},button2Action:function(){var e=this,t="channel/channels/",a={};if(this.cnoValid)if(a["cno"]=this.cno,this.cidValid)if(a["cid"]=this.cid.trim(),this.nameValid)if(a["name"]=this.name.trim(),this.siteValid)if(a["site"]=this.site.trim(),this.urlValid){a["url"]=this.url.trim();var n=f["a"].apiAjaxPost;this.channelId&&(t="".concat(t).concat(this.channelId,"/"),n=f["a"].apiAjaxPut),n(t,a,(function(t){0===t.code?e.$emit("channel-saved"):e.channelSaveFailed("通道信息保存失败(".concat(t.code,"): ").concat(t.message))}),s["a"].defaultApiErrorHandler(t,""))}else this.channelSaveFailed("通道URL不能为空！");else this.channelSaveFailed("通道位置不能为空！");else this.channelSaveFailed("通道名称不能为空！");else this.channelSaveFailed("通道ID为32位16进制数字！");else this.channelSaveFailed("请选择正确的通道号")},clearFields:function(){this.cno="",this.cid="",this.name="",this.site="",this.url=""},loadChannel:function(){var e=this,t="channel/channels/".concat(this.channelId,"/");f["a"].apiAjaxGet(t,{},(function(t){0===t.code?(e.cno=t.data.cno,e.cid=t.data.cid,e.name=t.data.name,e.site=t.data.site,e.url=t.data.url):alert("通道信息加载失败(".concat(t.code,"): ").concat(t.message))}),s["a"].defaultApiErrorHandler(t,""))},initChannelData:function(){this.channelId?this.loadChannel():(this.clearFields(),this.cno=this.freeNos[0],this.cid=this.getNewId())},getNewId:function(){var e=new m.a;return e.append("survmanage"),e.append((new Date).getTime().toString()),e.end()}},watch:{channelId:function(e){this.initChannelData()},freeNos:function(){this.initChannelData()}},mounted:function(){}},g=p,v=(a("2e2d"),a("2877")),w=Object(v["a"])(g,d,u,!1,null,null,null),C=w.exports,I=function(){var e=this,t=e._self._c;return t("div",[t("SimpleModalDlg",{attrs:{modalId:e.modalId,title:"删除通道",content:"所有该通道产生的报警信息都会被删除。确认删除通道（".concat(e.cno,"）吗？"),defaultButtonText:"取消",button2Text:"确认",button2Action:e.button2Action,dialogWidth:500}}),t("Toast",{attrs:{toastId:e.toastId,text:"通道删除成功！"}})],1)},S=[],y=a("8cbb"),D={name:"ChannelDeleteDlg",components:{SimpleModalDlg:h["a"]},data:function(){return{toastId:s["a"].randomId("toast")}},props:{modalId:{type:String,required:!0},channelId:{type:Number,required:!0},cno:{type:Number,required:!0}},computed:{},methods:{button2Action:function(){var e=this,t="channel/channels/".concat(this.channelId,"/"),a={};f["a"].apiAjaxDelete(t,a,(function(){y["a"].showToast(e.toastId),e.$emit("channel-deleted")}),s["a"].defaultApiErrorHandler(t,""))}},watch:{},mounted:function(){}},x=D,T=Object(v["a"])(x,I,S,!1,null,null,null),N=T.exports;window.channelRowSelected=function(e,t,a){window.currRowChannelId=e,window.currRowChannelNo=t,window.currRowChannelName=a};var R={name:"ModuleChConfig",components:{ApiDataTable:l["a"],ChannelEditDlg:C,ChannelDeleteDlg:N},data:function(){return{toastId:s["a"].randomId("toast"),toastText:"",iconDacha:!1,channelListTableId:s["a"].randomId("tableId"),channelEditDlgId:s["a"].randomId("modalId"),channelDeleteDlgId:s["a"].randomId("modalId"),tableComp:null,currRowChannelId:0,currRowChannelNo:0,currRowChannelName:"",freeNos:[1,2,3,4,5,6,7,8],usedNos:[]}},computed:{tableHandlers:function(){return{setComponent:this.tableSetComponent,getEndpoint:this.tableGetEndPoint,getParams:this.tableGetParams,tableRowFormatter:this.tableRowFormatter,getColSpecs:this.tableGetColSpecs,rowStyle:this.rowStyle,getDataList:this.getDataList,onPageLoaded:this.onPageLoaded}},availNos:function(){var e=[].concat(Object(o["a"])(this.freeNos),Object(o["a"])(this.usedNos));return e.sort()}},methods:{showToast:function(e,t){this.toastText=t,this.iconDacha=e,y["a"].showToast(this.toastId)},onChannelSaveFailed:function(e){this.showToast(!0,e)},onChannelSaved:function(){this.showToast(!1,"通道信息保存成功！"),this.reloadTable(),this.getUsedFreeChannels()},onChannelDeleted:function(){this.reloadTable(),this.getUsedFreeChannels()},onChannelAlgSaved:function(){},tableSetComponent:function(e){this.tableComp=e},tableRowFormatter:function(e){return{id:e.id,cno:e.cno,cid:e.cid,name:e.name,site:e.site,url:e.url,status:"...",operation:'\n          <div style="display:inline;">\n            <a class="icon-anchor" href="javascript:channelRowSelected('.concat(e.id,", ").concat(e.cno,", '").concat(e.name,"');$('#").concat(this.channelEditDlgId,'\').modal(\'show\')">\n              <div class="icon-box-green">\n                <i class="icon iconfont icon-bianji icon-inbox-white"></i>\n              </div>\n            </a>\n            <a class="icon-anchor" href="javascript:channelRowSelected(').concat(e.id,", ").concat(e.cno,", '").concat(e.name,"');$('#").concat(this.channelDeleteDlgId,'\').modal(\'show\')">\n              <div class="icon-box-red">\n                <i class="icon iconfont icon-shanchu icon-inbox-white"></i>\n              </div>\n            </a>\n          </div>\n        ')}},tableGetParams:function(){return{ordering:"cno"}},tableGetEndPoint:function(){return"channel/channels/"},tableGetColSpecs:function(){var e=[{field:"id",title:"ID",visible:!1},{field:"cno",title:"通道编号"},{field:"cid",title:"通道ID"},{field:"name",title:"通道名称"},{field:"site",title:"通道位置"},{field:"url",title:"URL"},{field:"status",title:"&nbsp;&nbsp;&nbsp;状态"},{field:"operation",title:"&nbsp;&nbsp;&nbsp;操作"}];return e},onTableSelectionChanged:function(){},reloadTable:function(){this.tableComp&&this.tableComp.getOnePage(),this.onTableSelectionChanged()},onPageLoaded:function(e,t){var a=this,n="channel/channels/get_real_time_status/?channel_ids=".concat(t.map((function(e){return e.id})).join(","));console.log("onPageLoaded",t,n),f["a"].apiAjaxGet(n,{},(function(e){0===e.code&&t.forEach((function(t,n){t.id in e.data&&a.tableComp.table.bootstrapTable("updateCell",{index:n,field:"status",value:'\n                  <span class="icon iconfont icon-dot" style="color: '.concat(e.data[t.id]?"green":"gray",';"></span>\n                  ').concat(e.data[t.id]?"在线":"离线","\n                ")})}))}),s["a"].defaultApiErrorHandler(n,""))},rowStyle:function(){var e={};return e},getDataList:function(e){return e.data.results},getUsedFreeChannels:function(){var e=this,t="channel/channels/get_used_free_channel_nos/";f["a"].apiAjaxGet(t,{},(function(t){0===t.code&&(e.freeNos=t.data.free_nos,e.usedNos=t.data.used_nos)}),s["a"].defaultApiErrorHandler(t,""))},beforeModalShow:function(){this.currRowChannelId=window.currRowChannelId,this.currRowChannelNo=window.currRowChannelNo,this.currRowChannelName=window.currRowChannelName,console.log("beforeModalShow",this.currRowChannelId,this.currRowChannelNo,this.currRowChannelName)}},mounted:function(){var e=this;r()("#".concat(this.channelEditDlgId)).on("show.bs.modal",(function(t){"relatedTarget"in t?e.currRowChannelId=0:e.beforeModalShow()})),r()("#".concat(this.channelDeleteDlgId)).on("show.bs.modal",(function(){e.beforeModalShow()})),this.getUsedFreeChannels()}},O=R,P=Object(v["a"])(O,n,i,!1,null,null,null);t["default"]=P.exports},"6b54":function(e,t,a){"use strict";a("3846");var n=a("cb7c"),i=a("0bfb"),o=a("9e1e"),l="toString",s=/./[l],c=function(e){a("2aba")(RegExp.prototype,l,e,!0)};a("79e5")((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?c((function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):s.name!=l&&c((function(){return s.call(this)}))},b1e1:function(e,t,a){},f217:function(e,t,a){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid w-100 overflow-auto"},[t("table",{staticClass:"text-nowrap",attrs:{id:e.tableId,"data-height":e.dataHeight,"data-classes":"table table-striped table-sm","data-sortable":"true","data-click-to-select":"true","data-pagination":e.pagination,"data-side-pagination":"server","data-detail-view":e.detailView,"data-detail-view-icon":"true","data-detail-view-by-click":"true","data-show-footer":e.showFooter}})])},i=[],o=(a("8e6e"),a("456d"),a("2909")),l=(a("ac6a"),a("7514"),a("ade3")),s=(a("c5f6"),{transCellSelected2ItemSelected:function(e,t,a,n){var i=0,o=null;n&&(i=n.id,o=n),"selectedId"in e&&(e.selectedId=i),"selectedRow"in e&&(e.selectedRow=o),e.$emit("itemSelected",i,o)}}),c=a("1157"),r=a.n(c),d=a("0be2");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"ApiDataTable",components:{},data:function(){return{table:null,listSize:10,listOffset:0,searchText:"",sortOrder:"",sortField:"",timeoutIdReload:0,selectedIds:[],selectedRows:[]}},props:{tableId:{type:String,required:!1,default:"api_data_table"},handlers:{type:Object,required:!0},dataHeight:{type:Number,required:!1,default:500},loadData:{type:Boolean,required:!1,default:!0},inModal:{type:Boolean,required:!1,default:!1},showSearch:{type:Boolean,required:!1,default:!0},showFooter:{type:Boolean,required:!1,default:!1},detailView:{type:Boolean,required:!1,default:!0},pagination:{type:Boolean,required:!1,default:!0},checkbox:{type:Boolean,required:!1,default:!1}},methods:{detailFormatter:function(e,t){return"undefined"===typeof this.handlers.detailFormatter?this.defaultDetailFormatter(e,t):this.handlers.detailFormatter(e,t)},rowStyle:function(e,t){return"undefined"===typeof this.handlers.rowStyle?{}:this.handlers.rowStyle(e,t)},defaultDetailFormatter:function(e,t){var a=[];a.push('<div class="text-left"><pre>');var n=JSON.stringify(t,null,4);return a.push(n),a.push("</pre></div>"),a.join("")},getOnePage:function(){var e=this,t=this.handlers.getEndpoint();if(t){var a={limit:this.listSize,offset:this.listOffset,search:this.searchText,order:this.sortOrder,order_field:this.sortField};if(Object.assign(a,this.getSortParam()),"getParams"in this.handlers&&this.handlers.getParams){var n=this.handlers.getParams();n&&(a=h(h({},a),n))}d["a"].apiAjaxGet(t,a,(function(t){if(0===t.code){var a=t.data,n=e.handlers.getDataList?e.handlers.getDataList(t):a.rows,i=[];for(var o in n){var l=e.handlers.tableRowFormatter(n[o],o,e);i.push(l)}e.table.bootstrapTable("load",i),e.table.bootstrapTable("refreshOptions",{totalRows:a.count}),e.handlers.onPageLoaded&&e.handlers.onPageLoaded(e,i)}else console.log("Got getOnePage error: "),console.log(t.data)}),(function(e){console.log(e)}),(function(){e.onTableSelectionChanged(),e.onTableDblClickCell(null,null,null,null)}))}},onSearch:function(e,t){this.searchText=t,console.log("onSearch",t)},onPageChange:function(e,t,a){console.log("onPageChange: ",t,a),this.listSize=a,this.listOffset=(t-1)*this.listSize,this.searchText=this.table.bootstrapTable("getOptions").searchText,this.getOnePage()},getSortParam:function(){var e=this.table.bootstrapTable("getOptions"),t=e.sortName,a=e.sortOrder;if(e.sortName)t=e.sortName,a=e.sortOrder;else{var n=e.columns[0].find((function(e){return"default-sort-order"in e}));if(!n)return{};t=n.field,a=n["default-sort-order"]}var i=t,o=e.columns[0].find((function(e){return e.field===t}));return"sort-name"in o&&(i=o["sort-name"]),i={asc:"",desc:"-"}[a]+i,console.log("onSort: ".concat(t,", ").concat(a,", ").concat(i),e),{ordering:i}},onTableDblClickCell:function(e,t,a,n){this.$emit("cellSelected",t,a,n)},getRowIndex:function(e,t){var a=-1,n=this.table.bootstrapTable("getData");return n.forEach((function(n,i){n[e]===t&&(a=i)})),a},refreshSelectedRow:function(e,t,a){var n=this.getRowIndex(e,t);n>=0&&this.table.bootstrapTable("showRow",{index:n});var i=this.getRowIndex(e,a);i>=0&&this.table.bootstrapTable("showRow",{index:i})},delayToReleadTable:function(e){var t=this;this.timeoutIdReload&&(clearTimeout(this.timeoutIdReload),this.timeoutIdReload=0),e&&(this.listOffset=0),this.timeoutIdReload=setTimeout((function(){t.timeoutIdReload=0,t.getOnePage()}),500)},onTableSelectionChanged:function(){this.selectedRows=this.table.bootstrapTable("getSelections"),this.selectedIds=this.selectedRows.map((function(e){return e.id})),this.$emit("selection-changed",this.selectedIds,this.selectedRows)},setEventForCheckbox:function(){this.checkbox&&(this.table.on("check.bs.table",this.onTableSelectionChanged),this.table.on("uncheck.bs.table",this.onTableSelectionChanged),this.table.on("check-all.bs.table",this.onTableSelectionChanged),this.table.on("uncheck-all.bs.table",this.onTableSelectionChanged))}},computed:{},watch:{loadData:function(e){e&&this.getOnePage()},checkbox:function(){this.setEventForCheckbox()}},mounted:function(){this.handlers.setComponent(this);var e=this.handlers.getColSpecs();this.checkbox&&(e=[{field:"selected",checkbox:!0,default:!1}].concat(Object(o["a"])(e)));var t=r()("#".concat(this.tableId));this.table=t,t.bootstrapTable({columns:e,pageNumber:1,pageSize:this.listSize,pageList:"[10, 20, 50, 100]",paginationHAlign:"right",paginationDetailHAlign:"left",detailFormatter:this.detailFormatter,rowStyle:this.rowStyle,search:this.showSearch,showJumpTo:!0}),t.on("reset-view.bs.table",(function(e,t){r()("div.bootstrap-table button").addClass("btn-sm"),r()("div.bootstrap-table button").addClass("btn-iview-size"),r()("div.bootstrap-table .page-jump-to > input").css("font-size","12px")})),t.on("search.bs.table",this.onSearch),t.on("sort.bs.table",this.getOnePage),t.on("page-change.bs.table",this.onPageChange),t.on("dbl-click-cell.bs.table",this.onTableDblClickCell),this.setEventForCheckbox(),this.loadData&&this.getOnePage()},transCellSelected2ItemSelected:function(e,t,a,n){s.transCellSelected2ItemSelected(e,t,a,n)}},b=f,m=a("2877"),p=Object(m["a"])(b,n,i,!1,null,"f1638840",null);t["a"]=p.exports}}]);